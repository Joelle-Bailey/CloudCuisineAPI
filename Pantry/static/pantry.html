<!DOCTYPE html>
<html>

<head>
    <title>My Pantry</title>
    <style>
        /* CSS for ingredient list */
        #ingredient-list {
            list-style-type: none;
            padding: 0;
        }

        /* CSS for search button */
        #search-btn {
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <h1> My Pantry</h1>
    <h2>Welcome, {{.Username}}!</h2>
    <form id="ingredientForm" action="/create" method="POST">
        <label for="ingredient">Enter Ingredient:</label>
        <input type="text" id="ingredient" name="ingredient" required>
        <button type="submit">Add Ingredient</button>
    </form>


    <ul id="ingredient-list"></ul>

    <button id="search-btn" onclick="searchIngredients()">Search</button>

    <script>
        let ingredients = [];
        fetch('/username')
            .then(response => response.json())
            .then(data => {
                const welcomeUser = document.getElementById('welcome-user');
                welcomeUser.textContent = `Welcome Back, ${data.username}!`;
            })
            .catch(error => {
                console.error('Error fetching username:', error);
            });
        


        function deleteIngredient(ingredient) {
            fetch('/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ ingredient })
            })
                .then(response => {
                    if (response.ok) {
                        ingredients = ingredients.filter(item => item !== ingredient);
                        renderIngredients();
                    } else {
                        throw new Error('Failed to delete ingredient');
                    }
                })
                .catch(error => {
                    console.error('Error deleting ingredient:', error);
                });
        }

        function renderIngredients() {
            const ingredientList = document.getElementById('ingredient-list');
            ingredientList.innerHTML = '';
            ingredients.forEach((ingredient) => {
                const li = document.createElement('li');
                li.textContent = ingredient;
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'x';
                deleteBtn.addEventListener('click', () => deleteIngredient(ingredient));
                li.appendChild(deleteBtn);
                ingredientList.appendChild(li);
            });
        }


        function searchIngredients() {
            // You can implement the search functionality here
            alert('Search functionality not implemented yet');
        }

        // Initial fetch to populate ingredients list
        // Fetch all ingredients
        fetch('/list')
            .then(response => response.json())
            .then(data => {
                ingredients = data;
                renderIngredients();
            })
            .catch(error => {
                console.error('Error fetching ingredients:', error);
            });


        // Listen for form submission event
        document.getElementById('ingredientForm').addEventListener('submit', event => {
            event.preventDefault(); // Prevent form submission
            const ingredientInput = document.getElementById('ingredient');
            const ingredient = ingredientInput.value.trim();
            if (!ingredient) {
                alert('Please enter an ingredient');
                return;
            }
            fetch('/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ ingredient })
            })
                .then(response => response.json())
                .then(data => {
                    ingredients.push(data.ingredient);
                    renderIngredients();
                    ingredientInput.value = ''; // Clear the form input
                })
                .catch(error => {
                    console.error('Error adding ingredient:', error);
                });
        });

    </script>
</body>

</html>